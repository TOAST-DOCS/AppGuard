## Security > NHN AppGuard > コンソール使用ガイド

NHN AppGuardはAndroid、iOS、Unity環境をサポートします。

### Android

* AppGuard Android SDKを適用することで、さらに強化された機能を利用できます(オプション)。
* Android StudioなどでビルドしたapkまたはaabファイルをWebコンソールまたはCLIを通じてアプリをより簡単に保護できます(必須)。

### iOS

* AppGuard iOS SDKを適用してアプリを保護できます(必須)。
* XcodeでビルドしたipaファイルをWebコンソールまたはCLIを通じてより強力に保護できます(オプション)。
* WebコンソールまたはCLIを通じてアプリ保護作業を行わない場合、基本ポリシーであるBusinessプランで動作します。
* WebコンソールまたはCLIでアプリ保護作業を行うことで、整合性検証、署名者検証、基本ポリシーの適用、難読化、プラン選択など、ソリューションのさまざまな機能を利用できます。
  * この保護作業による追加費用の請求はありません。

> [注意]
> Businessプラン以外のプランを設定したり、プランを変更する必要がある場合は、WebコンソールまたはCLIでアプリ保護作業を行う必要があります。アプリ保護作業を希望しない場合は、個別相談をリクエストして進めてください。

### Unity

* Android/iOSアプリを簡単に保護できる便利な機能を提供します。
* Unity SDKにはAndroid SDKとiOS SDKが含まれており、一つのインターフェイスで適用が可能です。

NHN AppGuardの使用するための適用段階は次のとおりです。

![[図1] NHN AppGuard適用方法](http://static.toastoven.net/prod_appguard/AppGuard_3_overview01.png)

## ダッシュボード

アプリ保護作業が完了したアプリをアプリストアに配布し、アビューズユーザーが探知されると、下図の**ダッシュボード** タブで現況を確認できます。

![appguard_01_202104](http://image.toast.com/aaaaaha/console-guide/1_1_%EB%8C%80%EC%8B%9C%EB%B3%B4%EB%93%9C_jp_240329.png)

- **異常行為の検知状況**は、NHN AppGuardが検知したアビューズユーザーのログ検知パターン、期間別の試行順序を確認できます。
- **異常行為検知状況の結果**は、右上のレポートダウンロード(Excel)ボタンをクリックしてダウンロードできます。
- **ダッシュボード**はNHN AppGuardが探知したアビューズユーザーの統計グラフとリストを検索できます。
    - ルート化の場合、アプリインストール後、1日1回検知または制裁ログをダッシュボードで確認できます。
- [ユーザーID]、 [デバイスID]、 [ログ探知回数]、 [ログ探知パターン]、 [照会期間]で **検索**できます。
    - [ユーザーID]と[デバイスID]は、カンマで区切って複数の条件を追加できます。
- 検出統計グラフは **検出パターン別の比率**と期間別**検出ログの増減現況**を確認できます。
- **異常行為検出現況**はAPIを通じてjson形式でも照会できます。詳細は[APIガイド](https://docs.nhncloud.com/ko/Security/NHN%20AppGuard/ko/api-guide/)を参照してください。  

## アプリ保護

### SDKダウンロードおよび連携

**アプリ保護** メニューを選択し、 **SDKダウンロード** ボタンを押すと、OS別にSDKをダウンロードできます。

SDKをダウンロードした後、添付のマニュアルに従って連動します。

### 難読化の有効化を申請する

**アプリ保護**メニューを選択し、**難読化有効化**ボタンを押すと、Android OSのコード難読化を申請できます。
Android OSのコード難読化は、月100万KRWの追加料金が発生します。
iOSはアプリ保護作業時にコード難読化を利用するかどうかを選択することができ、これによる追加費用は請求されません。

### アプリ保護メニュー選択

**アプリ保護** メニュー選択後、**+ アプリ保護** ボタンをクリックすると、次のような画面が表示されます。

![appguard_02_202104](http://image.toast.com/aaaaaha/console-guide/2_1_%EC%95%B1%EB%B3%B4%ED%98%B8_jp_240329.png)

* [証明書]ファイルを選択します。 AndroidはKeyStoreファイルです。
* [マスターパスワード]を入力し、 [有効性検査]ボタンをクリックして証明書ファイルの有効性を検査します。
* この検査作業はアプリ保護作業前のKeyStoreの有効性と適切なエイリアスを選択するためのものです。
* 有効性の検査に失敗した時、証明書ファイルが正常かどうか、そしてマスターパスワードを確認します。
* [エイリアス]名を選択します。
* [エイリアス パスワード]を入力します。
* [保護するアプリ]を選択します。
* [プラン]を選択します。
    - Business:アプリに対する異常行為及びパターンベースの基本的なセキュリティ検出機能
    - Enterprise: Business+Javaコード(DEX)暗号化+メモリ操作検出などの動的分析防御機能(一般アプリ推奨)
    - Game: Enterprise+ゲームエンジンライブラリ静的保護+Unity IL2CPPコード分析防御など、強化された動的分析防御セキュリティ機能(ゲームアプリ推奨)
    - 各プランで提供される全体機能は[AppGuardサービスガイド](https://www.nhncloud.com/kr/service/security/nhn-appguard)を参照してください。
* [リリースバージョン]を選択します。
* **確認**ボタンをクリックしてアプリ保護をします。
    - アプリ保護が完了したら、保護されたアプリをダウンロードできます。保護された配布ファイルを各アプリストアにアップロードして配布してください。
* アプリ保護作業方法： Console、 CLI(Command Line Interface)

## ポリシー

NHN AppGuard作動中、コード、メモリ、速度操作試行を検知した時、取るべき遮断ポリシーを設定でき、'条件遮断'の場合、しきい値で遮断条件を設定できます。

![appguard_03_202104](http://image.toast.com/aaaaaha/console-guide/3_1_%EC%A0%95%EC%B1%85_jp.png)

- **全体遮断**に設定されたポリシーで検知された場合、NHN AppGuard案内ウィンドウが表示され、アプリが終了します。
- **条件遮断**の場合、設定した条件を満たすとブラックリストに登録され、そのユーザーがアプリを実行すると、NHN AppGuard案内ウィンドウが表示され、アプリが終了します。

制裁の内容はSDKに含まれている"NHN AppGuard Developer's Guide" 文書を参照してください。

### 遮断機能別紹介
- **NHN AppGuard > ポリシー > 全体遮断**
    - NHN AppGuardポリシー画面で**全体遮断**に設定した場合、当該行為が検出されるとすぐにアプリが終了します。
    - ポリシーによりアプリが終了した場合でも、異常行為なしでアプリを再実行すると、アプリを正常に使用できます。
    - ポリシーを全体遮断または検出に変更した場合、約1分後に再起動したアプリに適用されます。
- **NHN AppGuard** > **ポリシー** > **個別ブロック**
    - エミュレータとマクロツールに限り、すべてのタイプではなく、個々のツール単位でブロックできます。
    - 個別ブロックでブロックに設定された場合、全体ブロックと同じように、検出されるとすぐにアプリが終了します。
    - ポリシーの保存後、約1分後に再起動されたアプリに適用されます。
- **NHN AppGuard > ポリシー > 条件遮断**
    - NHN AppGuardポリシー画面で**条件遮断**に設定した場合、毎日00時00分に条件を満たしたユーザーをブラックリストに登録します。
    - 条件を満たすかどうかは、前日00:00:00～23:59:59まで発生した検出ログを基に判断し、各条件は種類別に独立して動作します。
    - 条件遮断で登録されたブラックリストはNHN AppGuardブラックリストタブで確認できます。
    - 条件遮断で登録されたブラックリストにより遮断されたユーザーはNHN AppGuardダッシュボードタブに表示されません。
    - 条件遮断でブラックリストに登録されたユーザーは、異常行為なしでアプリを実行しても、設定したブロック期間中はアプリを使用できません。
    - 条件遮断に設定または条件を変更した場合、約10分後にすべてのユーザーを対象に適用されます。
- **NHN AppGuard > ブラックリスト**機能による遮断
    - NHN AppGuardブラックリスト画面でユーザーをブラックリストに登録した場合、該当ユーザーがアプリを実行するとアプリが終了します。
    - ブラックリストに登録した直後からアプリが再実行される時に適用されます。

### 変更履歴
ポリシーを変更、保存する時、いつ、誰が、どのように変更したのか、その履歴を管理できます。
![appguard_04_202104](http://image.toast.com/aaaaaha/console-guide/3_2_%EC%A0%95%EC%B1%85%20%EB%B3%80%EA%B2%BD%EC%9D%B4%EB%A0%A5_jp.png)

### 個別ブロック

エミュレータとマクロツールに限り、すべてのタイプではなく、個々のツール単位でブロックできます。

- 個々のツール単位で**解除**、**検出**、**ブロック**を設定できます。
- **基本ポリシー**を通じて、識別されていないタイプに対するポリシーを設定できます。

### 条件追加
ポリシーメニュー選択後、各検知種類別の条件遮断ボタンをクリックすると、次のような画面が表示されます。
![appguard_05_202104](http://image.toast.com/aaaaaha/console-guide/3_3_%EC%A0%95%EC%B1%85%20%EC%A1%B0%EA%B1%B4%EC%B6%94%EA%B0%80_jp.png)

* 遮断基準を選択します。
* 国情報を選択します。
* 検知回数を入力します。
    - ルート化の場合、検知回数は1回に設定されます。
* 遮断期間(日)を選択します。
* 追加ボタンをクリックして条件を追加します。
* 条件遮断ボタンが有効化された状態で、保存ボタンをクリックして条件を適用します。
    - 前日累積検知ログをベースに条件が適用され、最初の条件適用までは最大10分かかります。
    - 以降は、毎日00時05分に前日累積検知ログをベースに条件が新たに適用されます。

### 条件確認

![appguard_06_202104](http://image.toast.com/aaaaaha/console-guide/3_4_%EC%A0%95%EC%B1%85%20%EC%A1%B0%EA%B1%B4%ED%99%95%EC%9D%B8_jp.png)

条件遮断ボタン横の▼ボタンをクリックして、追加された条件を確認できます。


## ブラックリスト

NHN AppGuardで提供するデバイスIDとSDK連携すると使用できるユーザーIDを登録して、特定端末とユーザーをブラックリストで管理します。

![appguard_07_202104](http://image.toast.com/aaaaaha/console-guide/4_1_%EB%B8%94%EB%9E%99%EB%A6%AC%EC%8A%A4%ED%8A%B8_jp.png)


### ブラックリスト登録

ブラックリストメニュー選択後、登録ボタンをクリックすると、次のような画面が表示されます。

![appguard_08_202104](http://image.toast.com/aaaaaha/console-guide/4_2_%EB%B8%94%EB%9E%99%EB%A6%AC%EC%8A%A4%ED%8A%B8%20%EB%93%B1%EB%A1%9D_jp.png)

* 登録IDを選択します。
* IDタイプを選択します。
* 登録理由を入力します。
* 遮断期間(日)を選択します。
* 登録ボタンをクリックし、ブラックリストに登録します。
* 登録されたブラックリストIDでアプリを実行すると、遮断期間中はNHN AppGuard案内ウィンドウが表示され、アプリが終了します。

### ブラックリストの解除

ブラックリストメニュー選択後、登録されたブラックリストの解除ボタンをクリックすると、次のような画面が表示されます。

![appguard_09_202104](http://image.toast.com/aaaaaha/console-guide/4_3_%EB%B8%94%EB%9E%99%EB%A6%AC%EC%8A%A4%ED%8A%B8%20%ED%95%B4%EC%A0%9C_jp.png)

* 解除ボタンをクリックして登録されたブラックリストを解除します。
* 解除されたブラックリストIDでアプリを実行すると、NHN AppGuardでアプリを終了させません。

### ブラックリストの再登録

メニュー選択後、解除されたブラックリストの再登録ボタンをクリックすると、次のような画面が表示されます。

![appguard_10_202104](http://image.toast.com/aaaaaha/console-guide/4_4_%EB%B8%94%EB%9E%99%EB%A6%AC%EC%8A%A4%ED%8A%B8%20%EC%9E%AC%EB%93%B1%EB%A1%9D_jp.png)

* **登録理由**と <strong>遮断期間(日)</strong>を修正します。
* 登録ボタンをクリックして、ブラックリストを修正した内容で登録します。
* 再登録されたブラックリストIDでアプリを実行すると、遮断期間中はNHN AppGuard案内ウィンドウが表示され、アプリが終了します。

## ログ照会

検出されたログの詳細を**ログ照会**タブで確認できます。
![appguard_11](http://image.toast.com/aaaaaha/console-guide/5_1_%EB%A1%9C%EA%B7%B8%EC%A1%B0%ED%9A%8C_jp_240329.png)

- **ユーザーID**、**デバイスID**、**ログ検出回数**、**ログの種類**、**照会期間**で検索できます。
    - **ユーザーID**と **デバイスID**はカンマ(,)で区切って複数の条件を追加できます。
- ユーザーIDとデバイスID、Host IP、デバイスモデル、OS、ログ、アプリ情報及び時刻が表示されます。
- ANDROID_IDカラムの情報を活用してGamebaseのdevice_keyを照会するのに使用できます。
- <strong>レポートのダウンロード(Excel)</strong>をクリックして照会結果をダウンロードできます。

## 設定

### アラーム設定

検出/遮断ログの数がしきい値を超えたときに設定したチャンネルでアラームを受信できます。

- しきい値設定
  - 比較期間中に発生した検出+遮断数の**中央値**に対して、今日発生した検出+遮断数が**しきい値**を超えると、アラームが発生します。
    - 中央値を使用する理由は、比較期間内に攻撃などの異常な活動によりログ数が急激に増加したケースの影響を減らすためです。
  - **しきい値**は10～10000%で設定できます。
  - 例えば、7日間発生したログ数が[5,5,5,5,7,7,7]で、設定したしきい値が100%の場合、今日発生したログ数が5個以上であれば、アラームが発生します。
- アラーム受信チャンネル設定
  - メールアドレスを最大5つまで入力してアラームを受信できます。
  - メールアドレスはカンマ(,)で区切って複数入力できます。
  - メールアドレスは追加または削除のみ可能です。修正はできません。
- アラームはしきい値を超えた時点から10分以内に送信されます。
- アラームメールを受信した場合、コンソールに接続して検出ログをご確認ください。

> [参考] <br>
> * アラームは1日に最大1回送信されます。
